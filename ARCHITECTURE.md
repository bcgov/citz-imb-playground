# TypeRacer Architecture & Tech Stack
Please note this document is generated by claude-sonnet-4.

## ğŸ—ï¸ System Architecture Overview

```mermaid
graph TB
    subgraph "Presentation Layer"
        U[ğŸ‘¤ Users] --> B[ğŸŒ Browser]
        B --> F[âš›ï¸ React Frontend]
    end
    
    subgraph "Application Layer"
        F <--> API[ğŸ”Œ REST API]
        F <--> WS[ğŸ”„ WebSocket]
        API --> BE[ğŸ–¥ï¸ Express Backend]
        WS --> BE
    end
    
    subgraph "Business Logic Layer"
        BE --> GS[ğŸ® Game Service]
        BE --> FS[ğŸ“ File Service]
        BE --> SH[ğŸ”Œ Socket Handlers]
    end
    
    subgraph "Data Layer"
        GS --> MEM[ğŸ’¾ In-Memory Storage]
        FS --> DISK[ğŸ’¿ File System]
    end
    
    subgraph "Monitoring Layer"
        BE --> SENTRY_BE[ğŸ“Š Sentry Backend]
        F --> SENTRY_FE[ğŸ“Š Sentry Frontend]
        SENTRY_BE --> SENTRY_DB[(ğŸ—„ï¸ Sentry DB)]
        SENTRY_FE --> SENTRY_DB
    end
    
    subgraph "Infrastructure"
        SENTRY_DB --> POSTGRES[(ğŸ˜ PostgreSQL)]
        SENTRY_DB --> REDIS[(ğŸ”´ Redis)]
        SENTRY_DB --> SENTRY_WEB[ğŸŒ Sentry Web UI]
    end

    style F fill:#61dafb,stroke:#333,stroke-width:2px
    style BE fill:#68a063,stroke:#333,stroke-width:2px
    style SENTRY_WEB fill:#b8d7ff,stroke:#333,stroke-width:2px
    style POSTGRES fill:#5196f0,stroke:#333,stroke-width:2px
    style REDIS fill:#dc382d,stroke:#333,stroke-width:2px
```

## ğŸ”§ Tech Stack Breakdown

```mermaid
graph LR
    subgraph "Frontend Stack"
        REACT[âš›ï¸ React 18]
        TS_FE[ğŸ“˜ TypeScript]
        ROUTER[ğŸ›£ï¸ React Router]
        SOCKET_CLIENT[ğŸ”Œ Socket.IO Client]
        SENTRY_REACT[ğŸ“Š Sentry React]
        
        REACT --> TS_FE
        REACT --> ROUTER
        REACT --> SOCKET_CLIENT
        REACT --> SENTRY_REACT
    end
    
    subgraph "Backend Stack"
        NODE[ğŸŸ¢ Node.js]
        EXPRESS[ğŸš‚ Express.js]
        TS_BE[ğŸ“˜ TypeScript]
        SOCKET_SERVER[ğŸ”Œ Socket.IO Server]
        MULTER[ğŸ“ Multer]
        CORS[ğŸŒ CORS]
        SENTRY_NODE[ğŸ“Š Sentry Node]
        
        NODE --> EXPRESS
        NODE --> TS_BE
        EXPRESS --> SOCKET_SERVER
        EXPRESS --> MULTER
        EXPRESS --> CORS
        EXPRESS --> SENTRY_NODE
    end
    
    subgraph "Shared"
        SHARED_TYPES[ğŸ”— Shared Types]
        TS_FE -.-> SHARED_TYPES
        TS_BE -.-> SHARED_TYPES
    end
    
    subgraph "Monitoring"
        SENTRY_SELF[ğŸ  Self-Hosted Sentry]
        POSTGRES_SENTRY[ğŸ˜ PostgreSQL]
        REDIS_SENTRY[ğŸ”´ Redis]
        DOCKER[ğŸ³ Docker Compose]
        
        SENTRY_SELF --> POSTGRES_SENTRY
        SENTRY_SELF --> REDIS_SENTRY
        DOCKER --> SENTRY_SELF
    end

    style REACT fill:#61dafb,stroke:#333,stroke-width:2px
    style NODE fill:#68a063,stroke:#333,stroke-width:2px
    style EXPRESS fill:#000000,stroke:#333,stroke-width:2px,color:#fff
    style SENTRY_SELF fill:#362d59,stroke:#333,stroke-width:2px,color:#fff
    style DOCKER fill:#2496ed,stroke:#333,stroke-width:2px,color:#fff
```

## ğŸŒŠ Data Flow Architecture

```mermaid
sequenceDiagram
    participant U as ğŸ‘¤ User
    participant F as âš›ï¸ Frontend
    participant API as ğŸ”Œ REST API
    participant WS as ğŸ”„ WebSocket
    participant BE as ğŸ–¥ï¸ Backend
    participant GS as ğŸ® Game Service
    participant S as ğŸ“Š Sentry

    Note over U,S: Game Creation Flow
    U->>F: Create Game
    F->>API: POST /api/games/create
    API->>BE: Process Request
    BE->>GS: Create Room
    GS->>BE: Return Room Code
    BE->>S: Track Game Created
    BE->>API: Return Response
    API->>F: Room Code
    F->>U: Display Room Code

    Note over U,S: Real-time Game Flow
    U->>F: Join Game
    F->>WS: join-room event
    WS->>BE: Handle Join
    BE->>GS: Add Participant
    BE->>S: Track Player Joined
    BE->>WS: Broadcast Updates
    WS->>F: room-joined event
    F->>U: Show Game Lobby

    Note over U,S: Typing Performance
    U->>F: Type Text
    F->>F: Calculate WPM/Accuracy
    F->>S: Track Typing Metrics
    F->>WS: typing-progress event
    WS->>BE: Update Progress
    BE->>GS: Store Progress
    BE->>WS: Broadcast Progress
    WS->>F: player-progress event
    F->>U: Update Leaderboard
```

## ğŸ¨ Frontend Component Architecture

```mermaid
graph TB
    subgraph "Pages Layer"
        HOME[ğŸ  HomePage]
        GAME[ğŸ® GamePage]
    end

    subgraph "Feature Components"
        HOST[ğŸ¯ HostGame]
        JOIN[ğŸ”— JoinGame]
        UPLOAD[ğŸ“ FileUpload]
    end

    subgraph "Game Components - Composed"
        LOBBY[ğŸ›ï¸ GameLobby]
        TYPING[âŒ¨ï¸ TypingInterface]
        RESULTS[ğŸ† GameResults]
    end

    subgraph "Game Sub-Components"
        TEXT_DISPLAY[ğŸ“ TextDisplay]
        TYPING_AREA[âŒ¨ï¸ TypingArea]
        LEADERBOARD[ğŸ“Š Leaderboard]
        CELEBRATION[ğŸ‰ CelebrationHeader]
        PERSONAL_STATS[ğŸ“ˆ PersonalStats]
        FINAL_LEADERBOARD[ğŸ… FinalLeaderboard]
    end

    APP[ğŸ“± App] --> HOME
    APP --> GAME
    HOME --> HOST
    HOME --> JOIN
    HOST --> UPLOAD
    GAME --> LOBBY
    GAME --> TYPING
    GAME --> RESULTS

    TYPING --> TEXT_DISPLAY
    TYPING --> TYPING_AREA
    TYPING --> LEADERBOARD

    RESULTS --> CELEBRATION
    RESULTS --> PERSONAL_STATS
    RESULTS --> FINAL_LEADERBOARD
```

## ğŸ›ï¸ Layered Architecture Detail

```mermaid
graph TB
    subgraph "Presentation Layer"
        UI[ğŸ¨ UI Components]
        PAGES[ğŸ“„ Pages]
        HOOKS[ğŸª React Hooks]
        STATE[ğŸ”„ State Management]
    end
    
    subgraph "API Layer"
        REST[ğŸŒ REST Endpoints]
        WEBSOCKET[ğŸ”Œ WebSocket Events]
        MIDDLEWARE[âš™ï¸ Middleware]
        VALIDATION[âœ… Validation]
    end
    
    subgraph "Business Logic Layer"
        GAME_SERVICE[ğŸ® Game Service]
        FILE_SERVICE[ğŸ“ File Service]
        SOCKET_HANDLERS[ğŸ”Œ Socket Handlers]
        UTILS[ğŸ› ï¸ Utilities]
    end
    
    subgraph "Data Access Layer"
        MEMORY[ğŸ’¾ In-Memory Store]
        FILE_SYSTEM[ğŸ’¿ File System]
        CACHE[âš¡ Cache Layer]
    end
    
    subgraph "Infrastructure Layer"
        SERVER[ğŸ–¥ï¸ HTTP Server]
        SOCKET_IO[ğŸ”Œ Socket.IO Server]
        MONITORING[ğŸ“Š Monitoring]
        LOGGING[ğŸ“ Logging]
    end

    UI --> REST
    PAGES --> WEBSOCKET
    HOOKS --> STATE
    
    REST --> GAME_SERVICE
    WEBSOCKET --> SOCKET_HANDLERS
    MIDDLEWARE --> VALIDATION
    
    GAME_SERVICE --> MEMORY
    FILE_SERVICE --> FILE_SYSTEM
    SOCKET_HANDLERS --> CACHE
    
    MEMORY --> SERVER
    FILE_SYSTEM --> SOCKET_IO
    CACHE --> MONITORING
    UTILS --> LOGGING

    style UI fill:#e1f5fe
    style GAME_SERVICE fill:#f3e5f5
    style MEMORY fill:#fff3e0
    style SERVER fill:#e8f5e8
```

## ğŸ”„ Real-time Communication Flow

```mermaid
graph LR
    subgraph "Client Side"
        REACT_APP[âš›ï¸ React App]
        SOCKET_CLIENT[ğŸ”Œ Socket.IO Client]
        UI_COMPONENTS[ğŸ¨ UI Components]
        
        REACT_APP --> SOCKET_CLIENT
        SOCKET_CLIENT --> UI_COMPONENTS
    end
    
    subgraph "Network Layer"
        WEBSOCKET[ğŸŒ WebSocket Connection]
        HTTP[ğŸ“¡ HTTP/HTTPS]
        
        SOCKET_CLIENT <--> WEBSOCKET
        REACT_APP <--> HTTP
    end
    
    subgraph "Server Side"
        EXPRESS_SERVER[ğŸš‚ Express Server]
        SOCKET_SERVER[ğŸ”Œ Socket.IO Server]
        GAME_LOGIC[ğŸ® Game Logic]
        
        HTTP <--> EXPRESS_SERVER
        WEBSOCKET <--> SOCKET_SERVER
        SOCKET_SERVER --> GAME_LOGIC
    end
    
    subgraph "Events"
        CLIENT_EVENTS[ğŸ“¤ Client Events<br/>â€¢ join-room<br/>â€¢ typing-progress<br/>â€¢ start-game]
        SERVER_EVENTS[ğŸ“¥ Server Events<br/>â€¢ room-joined<br/>â€¢ player-progress<br/>â€¢ game-started]
        
        SOCKET_CLIENT --> CLIENT_EVENTS
        SERVER_EVENTS --> SOCKET_CLIENT
        CLIENT_EVENTS --> SOCKET_SERVER
        SOCKET_SERVER --> SERVER_EVENTS
    end

    style WEBSOCKET fill:#4caf50,stroke:#333,stroke-width:2px,color:#fff
    style CLIENT_EVENTS fill:#2196f3,stroke:#333,stroke-width:2px,color:#fff
    style SERVER_EVENTS fill:#ff9800,stroke:#333,stroke-width:2px,color:#fff
```

## ğŸ“Š Monitoring Architecture

```mermaid
graph TB
    subgraph "Application Layer"
        FE[âš›ï¸ Frontend App]
        BE[ğŸ–¥ï¸ Backend App]
    end
    
    subgraph "Sentry SDKs"
        FE_SDK[ğŸ“Š @sentry/react]
        BE_SDK[ğŸ“Š @sentry/node]
        
        FE --> FE_SDK
        BE --> BE_SDK
    end
    
    subgraph "Data Collection"
        ERRORS[ğŸš¨ Error Tracking]
        PERFORMANCE[âš¡ Performance Monitoring]
        BREADCRUMBS[ğŸ Breadcrumbs]
        CUSTOM_METRICS[ğŸ“ˆ Custom Metrics]
        
        FE_SDK --> ERRORS
        FE_SDK --> PERFORMANCE
        BE_SDK --> BREADCRUMBS
        BE_SDK --> CUSTOM_METRICS
    end
    
    subgraph "Sentry Infrastructure"
        SENTRY_WEB[ğŸŒ Sentry Web]
        SENTRY_WORKER[âš™ï¸ Sentry Worker]
        SENTRY_CRON[â° Sentry Cron]
        
        ERRORS --> SENTRY_WEB
        PERFORMANCE --> SENTRY_WORKER
        BREADCRUMBS --> SENTRY_CRON
        CUSTOM_METRICS --> SENTRY_WEB
    end
    
    subgraph "Storage Layer"
        POSTGRES[ğŸ˜ PostgreSQL<br/>Events & Metadata]
        REDIS[ğŸ”´ Redis<br/>Cache & Sessions]
        CLICKHOUSE[ğŸ“Š ClickHouse<br/>Time Series Data]
        
        SENTRY_WEB --> POSTGRES
        SENTRY_WORKER --> REDIS
        SENTRY_CRON --> CLICKHOUSE
    end
    
    subgraph "Observability"
        DASHBOARD[ğŸ“Š Dashboard]
        ALERTS[ğŸš¨ Alerts]
        REPORTS[ğŸ“‹ Reports]
        
        POSTGRES --> DASHBOARD
        REDIS --> ALERTS
        CLICKHOUSE --> REPORTS
    end

    style SENTRY_WEB fill:#362d59,stroke:#333,stroke-width:2px,color:#fff
    style POSTGRES fill:#336791,stroke:#333,stroke-width:2px,color:#fff
    style REDIS fill:#dc382d,stroke:#333,stroke-width:2px,color:#fff
```

## ğŸš€ Deployment Architecture

```mermaid
graph TB
    subgraph "Development Environment"
        DEV_FE[âš›ï¸ React Dev Server<br/>:3000]
        DEV_BE[ğŸ–¥ï¸ Node.js Dev Server<br/>:3001]
        DEV_SENTRY[ğŸ“Š Sentry Dev<br/>:9000]
        
        DEV_FE <--> DEV_BE
        DEV_BE --> DEV_SENTRY
        DEV_FE --> DEV_SENTRY
    end
    
    subgraph "Production Environment"
        NGINX[ğŸŒ Nginx<br/>Reverse Proxy]
        PROD_FE[âš›ï¸ React Build<br/>Static Files]
        PROD_BE[ğŸ–¥ï¸ Node.js Server<br/>PM2 Cluster]
        PROD_SENTRY[ğŸ“Š Sentry Production<br/>Load Balanced]
        
        NGINX --> PROD_FE
        NGINX --> PROD_BE
        PROD_BE --> PROD_SENTRY
        PROD_FE --> PROD_SENTRY
    end
    
    subgraph "Container Infrastructure"
        DOCKER[ğŸ³ Docker]
        COMPOSE[ğŸ™ Docker Compose]
        VOLUMES[ğŸ’¾ Persistent Volumes]
        
        DEV_SENTRY --> DOCKER
        PROD_SENTRY --> COMPOSE
        COMPOSE --> VOLUMES
    end
    
    subgraph "Monitoring Stack"
        POSTGRES_PROD[ğŸ˜ PostgreSQL<br/>Primary DB]
        REDIS_PROD[ğŸ”´ Redis<br/>Cache & Queue]
        BACKUP[ğŸ’¾ Backup Storage]
        
        PROD_SENTRY --> POSTGRES_PROD
        PROD_SENTRY --> REDIS_PROD
        POSTGRES_PROD --> BACKUP
    end

    style NGINX fill:#009639,stroke:#333,stroke-width:2px,color:#fff
    style DOCKER fill:#2496ed,stroke:#333,stroke-width:2px,color:#fff
    style COMPOSE fill:#2496ed,stroke:#333,stroke-width:2px,color:#fff
```

## ğŸ§© Component Composition Patterns

### Design Principles
- **Single Responsibility**: Each component has one clear purpose
- **Composition over Inheritance**: Building complex UIs from simple components
- **Props Interface Design**: Clean, typed interfaces for component communication
- **External CSS**: Separation of styling from component logic
- **Reusability**: Components designed for reuse across the application

### Component Hierarchy

#### Main Game Components
```
TypingInterface (108 lines)
â”œâ”€â”€ TextDisplay (42 lines)
â”œâ”€â”€ TypingArea (56 lines)
â””â”€â”€ Leaderboard (40 lines)

GameResults (40 lines)
â”œâ”€â”€ CelebrationHeader (35 lines)
â”œâ”€â”€ PersonalStats (45 lines)
â””â”€â”€ FinalLeaderboard (50 lines)

GameLobby (85 lines)
â””â”€â”€ External CSS (GameLobby.css)
```

#### Benefits Achieved
- **Reduced Complexity**: Main components are 48-88% smaller
- **Better Maintainability**: Changes isolated to specific components
- **Improved Testability**: Smaller components easier to unit test
- **Enhanced Reusability**: Sub-components can be used independently
- **Cleaner Code**: Separation of concerns and focused responsibilities

### CSS Architecture
- **Component-Scoped CSS**: Each component has its own stylesheet
- **Responsive Design**: Mobile-first approach with media queries
- **Consistent Naming**: BEM-like naming conventions
- **Performance**: External CSS files for better caching
- **Maintainability**: Styles separated from component logic

## ğŸ“‹ Technology Specifications

### Frontend Technologies
- **React 18**: Modern React with concurrent features
- **TypeScript**: Full type safety and IntelliSense
- **React Router v6**: Client-side routing
- **Socket.IO Client**: Real-time communication
- **CSS3**: Modern styling with Grid and Flexbox
- **Sentry React**: Error tracking and performance monitoring

### Backend Technologies
- **Node.js 16+**: JavaScript runtime
- **Express.js**: Web application framework
- **TypeScript**: Server-side type safety
- **Socket.IO**: Real-time bidirectional communication
- **Multer**: File upload handling
- **CORS**: Cross-origin resource sharing
- **Sentry Node**: Server-side monitoring

### Monitoring & Infrastructure
- **Self-Hosted Sentry**: Complete observability platform
- **PostgreSQL**: Primary database for Sentry
- **Redis**: Caching and session storage
- **Docker Compose**: Container orchestration
- **Hot Reload**: Development productivity tools

### Development Tools
- **nodemon**: Backend hot reload
- **React HMR**: Frontend hot module replacement
- **Shared Types**: Cross-platform type definitions
- **ESLint/Prettier**: Code quality and formatting

## ğŸ›ï¸ BC Gov Design System

The frontend uses the [BC Gov Design System](https://designsystem.digital.gov.bc.ca/) for UI components and styling:
- Components (Buttons, inputs, form and etc) are imported from `@bcgov/design-system-react-components`.
- Typography and layout use BC Gov design tokens and BC Sans font.
- All interactive and visual elements follow BC Gov accessibility and branding standards.

This ensures a consistent, accessible, and modern user experience across all pages and components.

This architecture provides a scalable, maintainable, and observable real-time multiplayer typing application with comprehensive monitoring capabilities.
